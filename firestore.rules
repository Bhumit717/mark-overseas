rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    function isAllowedDomain() {
      return request.resource.data.authorizedDomain in [
        'https://mark-overseas.com',
        'https://www.mark-overseas.com',
        'https://mark-overseas.vercel.app',
        'https://www.mark-overseas.vercel.app'
      ];
    }

    function correctPassword(pwd) {
      return pwd == 'Mark_Vault'; 
    }

    match /inquiry_vault/{pwd}/data/{id} {
      // ✅ ADD DETAILS → ONLY DOMAIN REQUIRED
      allow create: if isAllowedDomain();

      // ✅ READ / DELETE → DOMAIN + PASSWORD REQUIRED
      allow read, delete: if correctPassword(pwd)
                          && resource.data.authorizedDomain in [
                            'https://mark-overseas.com',
                            'https://www.mark-overseas.com',
                            'https://mark-overseas.vercel.app',
                            'https://www.mark-overseas.vercel.app'
                          ];
    }

    // ✅ SMTP SETTINGS → ONLY DOMAIN REQUIRED (NO PASSWORD)
    match /settings/smtp {
      allow read: if true;   // rules cannot see domain → App Check handles real restriction
    }

    match /{document=**} {
      allow read, write: if false;
    }
  }
}
