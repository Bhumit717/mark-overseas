rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    function isAllowedDomain() {
      return request.resource.data.authorizedDomain in [
        'https://mark-overseas.com',
        'https://www.mark-overseas.com',
        'https://mark-overseas.vercel.app',
        'https://www.mark-overseas.vercel.app'
      ];
    }

    function correctPassword(pwd) {
      // ðŸ”‘ The Master Key for the Admin
      return pwd == 'Mark_Vault'; 
    }

    match /inquiry_vault/{pwd}/data/{id} {
      // âœ… ADD DETAILS â†’ ONLY DOMAIN REQUIRED
      allow create: if isAllowedDomain();

      // âœ… ADMIN READ / DELETE â†’ ONLY PASSWORD REQUIRED
      // We removed the resource.data.authorizedDomain check here 
      // because it was blocking the Admin Dashboard from loading the full list.
      allow read, delete: if correctPassword(pwd);
    }

    // âœ… SMTP SETTINGS â†’ REQUIRED FOR INSTANT EMAIL
    match /settings/smtp {
      allow read: if true;
    }

    match /{document=**} {
      allow read, write: if false;
    }
  }
}
